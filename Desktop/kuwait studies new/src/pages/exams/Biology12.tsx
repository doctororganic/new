import React, { useState, useEffect } from 'react'
import { useNavigate } from 'react-router-dom'
import { Clock, ChevronLeft, ChevronRight, CheckCircle, XCircle, RotateCcw } from 'lucide-react'
import PromotionalBox from '../../components/PromotionalBox'
import ContactMessage from '../../components/ContactMessage'

interface Question {
  text: string
  options: string[]
  correct: number
  explanation: string
}

interface Exam {
  id: number
  questions: Question[]
}

const Biology12: React.FC = () => {
  const navigate = useNavigate()
  const [currentExam, setCurrentExam] = useState(1)
  const [currentQuestion, setCurrentQuestion] = useState(0)
  const [answers, setAnswers] = useState<Record<string, string>>({})
  const [showResults, setShowResults] = useState(false)
  const [timeLeft, setTimeLeft] = useState(30 * 60) // 30 minutes
  const [submitted, setSubmitted] = useState(false)
  const [showPromotionalBox, setShowPromotionalBox] = useState(false)
  const [promotionalBoxShown, setPromotionalBoxShown] = useState(false)
  const [showContactMessage, setShowContactMessage] = useState(false)
  const [formSubmitted, setFormSubmitted] = useState(false)

  // Full question bank: 7 exams × 20 questions
  const exams: Record<number, Exam> = {
    1: {
      id: 1,
      questions: [
        { text: "ما السبب المباشر لانعكاس اليد عند لمس سطح ساخن؟", options: ["الدماغ", "النخاع الشوكي", "العصب الحسي فقط", "العصب الحركي فقط"], correct: 1, explanation: "ينفذ الانعكاس الشوكي في النخاع دون تدخل الدماغ لسرعة الاستجابة." },
        { text: "أي من الآتي يعبر عن جهد الراحة في العصبون؟", options: ["+30 mV", "-50 mV", "-70 mV", "0 mV"], correct: 2, explanation: "جهد الراحة الطبيعي للعصبون هو -70 mV بسبب توزيع الأيونات عبر الغشاء." },
        { text: "ما وظيفة غمد المايلين؟", options: ["إبطاء التوصيل", "عزل المحور وزيادة سرعة التوصيل", "تخزين الهرمونات", "إفراز النواقل"], correct: 1, explanation: "غمد المايلين يعزل المحور العصبي ويساعد على التوصيل بالقفز العصبي." },
        { text: "ما الغدة التي تفرز هرمون النمو (GH)؟", options: ["الدرقية", "النخامية", "الكظرية", "البنكرياس"], correct: 1, explanation: "الغدة النخامية الأمامية تفرز هرمون النمو (GH)." },
        { text: "ما تأثير نقص هرمون الأنسولين؟", options: ["انخفاض سكر الدم", "ارتفاع سكر الدم", "زيادة الكالسيوم", "انخفاض الصوديوم"], correct: 1, explanation: "الأنسولين يخفض سكر الدم؛ نقصه يؤدي إلى ارتفاعه (السكري)." },
        { text: "ما نوع المناعة التي توفرها الخلايا التائية القاتلة؟", options: ["جسمانية", "خلوية", "غير نوعية", "مكتسبة سلبياً"], correct: 1, explanation: "الخلايا التائية القاتلة جزء من المناعة الخلوية التي تستهدف الخلايا المصابة." },
        { text: "ما وظيفة الخلايا البائية؟", options: ["تدمير البكتيريا", "إفراز الهرمونات", "إفراز الأجسام المضادة", "نقل الأكسجين"], correct: 2, explanation: "الخلايا البائية تنتج أجساماً مضادة محددة ضد المستضدات." },
        { text: "ما المستقبلات الموجودة في الأذن الداخلية؟", options: ["ضوئية", "كيميائية", "ميكانيكية", "حرارية"], correct: 2, explanation: "الأذن الداخلية تحتوي مستقبلات ميكانيكية تستجيب للاهتزازات (الصوت والتوازن)." },
        { text: "ما السبب في أن المناعة المكتسبة أسرع عند التعرض الثاني للممرض؟", options: ["وجود خلايا ذاكرة", "زيادة عدد الكريات البيض", "ارتفاع درجة الحرارة", "نشاط الغدة الزعترية"], correct: 0, explanation: "خلايا الذاكرة المناعية تسرّع الاستجابة عند التعرض الثاني." },
        { text: "ما الغدة التي تفرز هرمون الثيروكسين؟", options: ["النخامية", "الكظرية", "الدرقية", "البنكرياس"], correct: 2, explanation: "تفرز الغدة الدرقية هرمون الثيروكسين الذي ينظم التمثيل الغذائي." },
        { text: "ما العلاقة بين الوطاء والغدة النخامية؟", options: ["الوطاء يفرز كل هرمونات النخامية", "الوطاء يتحكم في النخامية عبر الأعصاب والهرمونات", "النخامية تتحكم في الوطاء", "لا علاقة بينهما"], correct: 1, explanation: "الوطاء يربط الجهاز العصبي بالغدد الصماء عبر التحكم بالنخامية." },
        { text: "ما وظيفة المشبك الكهربائي؟", options: ["أبطأ من الكيميائي", "ينتقل فيه السيال في اتجاهين", "يعتمد على النواقل", "لا يوجد في الإنسان"], correct: 1, explanation: "المشبك الكهربائي يسمح بانتقال السيال في اتجاهين، لكنه نادر في الإنسان." },
        { text: "ما تأثير هرمون ADH عند الجفاف؟", options: ["يزيد إنتاج البول", "يقلل إعادة امتصاص الماء", "يزيد إعادة امتصاص الماء", "يحفز العطش فقط"], correct: 2, explanation: "هرمون ADH يزيد إعادة امتصاص الماء في الكلى لتقليل فقدانه." },
        { text: "ما خاصية العصبون الحركي؟", options: ["مستقبلاته في الجلد", "يبدأ في النخاع وينتهي في العضلات", "لا يحتوي على جسم خلوي", "يحمل السيال من الدماغ إلى المستقبل"], correct: 1, explanation: "العصبون الحركي ينقل الإشارة من الجهاز العصبي المركزي إلى العضلات." },
        { text: "ما وظيفة المادة البيضاء في النخاع؟", options: ["تحتوي أجسام الخلايا", "تحتوي المحاور المغمدة", "تعمل على التفكير", "تفرز الهرمونات"], correct: 1, explanation: "المادة البيضاء تتكون من المحاور المغمدة التي تنقل الإشارات." },
        { text: "ما نوع المستقبلات في اللسان؟", options: ["ميكانيكية", "ضوئية", "كيميائية", "حرارية"], correct: 2, explanation: "براعم التذوق تحتوي مستقبلات كيميائية تستجيب للجزيئات الذائبة." },
        { text: "ما السبب في أن الهرمونات تؤثر على خلايا محددة؟", options: ["كل الخلايا تتجاوب مع كل الهرمونات", "وجود مستقبلات متوافقة فقط", "سرعة تدفق الدم", "تركيز الأكسجين"], correct: 1, explanation: "الهرمون يؤثر فقط على الخلايا التي تحتوي على مستقبلات خاصة به." },
        { text: "ما دور الخلايا الدبقية؟", options: ["توليد جهد الفعل", "دعم وعزل العصبونات", "إفراز الأدرينالين", "نقل الضوء"], correct: 1, explanation: "الخلايا الدبقية تدعم العصبونات عزلها وتغذيتها." },
        { text: "ما تأثير الكورتيزول على المناعة؟", options: ["يقويها", "يثبطها", "لا يؤثر", "يزيد الأجسام المضادة"], correct: 1, explanation: "الكورتيزول هرمون كظري يثبط الاستجابة المناعية." },
        { text: "ما المرحلة التي يعود فيها جهد الغشاء إلى -70 mV بعد جهد الفعل؟", options: ["الاستقطاب", "إعادة الاستقطاب", "فرط الاستقطاب", "الراحة"], correct: 1, explanation: "إعادة الاستقطاب هي عودة الجهد إلى حالته الطبيعية بعد جهد الفعل." }
      ]
    },
    2: {
      id: 2,
      questions: [
        { text: "ما السبب في أن السيال العصبي ينتقل في اتجاه واحد في المشبك؟", options: ["طبيعة المحور", "وجود النواقل العصبية في الحويصلة فقط في النهاية قبل المشبكية", "سرعة التيار", "نوع المستقبل"], correct: 1, explanation: "النواقل العصبية تُخزن فقط في النهاية قبل المشبكية، لذا ينتقل السيال في اتجاه واحد." },
        { text: "ما وظيفة هرمون TSH؟", options: ["تنشيط الغدة الكظرية", "تنشيط الغدة الدرقية", "خفض سكر الدم", "تحفيز النمو"], correct: 1, explanation: "هرمون TSH يحفز الغدة الدرقية لإفراز الثيروكسين." },
        { text: "ما الفرق بين المناعة النوعية وغير النوعية؟", options: ["النوعية أسرع", "غير النوعية محددة", "النوعية تتميز بالذاكرة", "غير النوعية تستخدم الأجسام المضادة"], correct: 2, explanation: "المناعة النوعية تتسم بوجود خلايا ذاكرة وتخصص كبير ضد المستضدات." },
        { text: "ما المستقبل المسؤول عن الرؤية في الضوء الخافت؟", options: ["المخاريط", "العصي", "الخلايا العقدية", "الخلايا الدبقية"], correct: 1, explanation: "العصي مسؤولة عن الرؤية في الإضاءة الخافتة، بينما المخاريط للرؤية النهارية والألوان." },
        { text: "ما تأثير ارتفاع مستوى الكالسيوم في الدم؟", options: ["يحفز الغدة جارات الدرقية", "يثبط الغدة جارات الدرقية", "لا يؤثر", "يزيد إفراز الثيروكسين"], correct: 1, explanation: "ارتفاع الكالسيوم يثبط الغدة جارات الدرقية عن إفراز هرمونها." },
        { text: "ما خاصية جهد الفعل؟", options: ["يتغير حسب شدة المثير", "كل أو لا شيء", "يتلاشى مع المسافة", "يعتمد على البوتاسيوم فقط"], correct: 1, explanation: "جهد الفعل يتبع قانون 'كل أو لا شيء'؛ إما يُنشأ كاملاً أو لا يُنشأ." },
        { text: "ما دور الغدة الزعترية؟", options: ["تنضج الخلايا البائية", "تنضج الخلايا التائية", "تفرز الأجسام المضادة", "تخزن الدم"], correct: 1, explanation: "الغدة الزعترية مكان نضج الخلايا التائية." },
        { text: "ما السبب في أن العدوى الفيروسية تصعب المناعة الجسمانية؟", options: ["الفيروسات خارج الخلايا", "الفيروسات داخل الخلايا", "الفيروسات لا تحمل مستضدات", "الفيروسات تدمّر الخلايا البائية"], correct: 1, explanation: "المناعة الجسمانية (الأجسام المضادة) لا تستطيع الوصول للفيروسات داخل الخلايا، لذا تحتاج المناعة الخلوية." },
        { text: "ما الغدة التي تفرز هرمون الأوكسيتوسين؟", options: ["النخامية الأمامية", "النخامية الخلفية", "الوطاء", "الكظرية"], correct: 1, explanation: "يُخزن ويُفرز الأوكسيتوسين من الفص الخلفي للنخامية رغم تصنيعه في الوطاء." },
        { text: "ما تأثير نقص هرمون الثيروكسين عند الأطفال؟", options: ["القزامة", "التخلف العقلي", "داء كوشينغ", "البلوغ المبكر"], correct: 1, explanation: "نقص الثيروكسين في الطفولة يؤدي إلى التخلف العقلي وتأخر النمو (الكَرَس)." },
        { text: "ما وظيفة المشبك الكيميائي؟", options: ["يسمح بالانتقال في اتجاهين", "أبطأ لكنه قابل للتعديل", "أكثر شيوعاً في العضلات", "لا يستخدم نواقل"], correct: 1, explanation: "المشبك الكيميائي أبطأ لكنه يسمح بالتعديل (التعزيز أو التثبيط)." },
        { text: "ما السبب في أن بعض الأدوية تؤثر على المشبك؟", options: ["تحاكي النواقل أو تمنعها", "تغير جهد الغشاء", "تدمر المحور", "تزيد سرعة التوصيل"], correct: 1, explanation: "العديد من الأدوية تعمل كمحاكيات أو مضادات للنواقل العصبية." },
        { text: "ما وظيفة الخلايا القاتلة الطبيعية (NK)؟", options: ["إفراز الأجسام المضادة", "تدمير الخلايا السرطانية والمصابة", "تنضج في النخاع", "تفرز الهرمونات"], correct: 1, explanation: "الخلايا القاتلة الطبيعية جزء من المناعة غير النوعية وتستهدف الخلايا غير الطبيعية." },
        { text: "ما المستقبلات في الجلد للمس؟", options: ["كيميائية", "ضوئية", "ميكانيكية", "حرارية"], correct: 2, explanation: "مستقبلات اللمس في الجلد ميكانيكية (مثل جسيمات مايسنر)." },
        { text: "ما الهرمون الذي يفرز عند الخوف؟", options: ["الأنسولين", "الأوكسيتوسين", "الأدرينالين", "البرولاكتين"], correct: 2, explanation: "الأدرينالين يفرز من لب الغدة الكظرية في حالات الإجهاد والخوف." },
        { text: "ما الفرق بين العصبون الحسي والحركي؟", options: ["الحسي ينقل من المركز إلى العضو", "الحسي يحتوي على جسم خلوي في النخاع", "الحسي مستقبلاته خارجية", "الحركي ينقل من المستقبل إلى المركز"], correct: 2, explanation: "العصبون الحسي مستقبلاته في الجلد أو الأعضاء، وينقل الإشارة إلى الجهاز العصبي المركزي." },
        { text: "ما دور هرمون FSH عند الذكور؟", options: ["تنشيط الخصيتين لإفراز التستوستيرون", "تحفيز تكوين الحيوانات المنوية", "تنشيط البروستاتا", "زيادة إنتاج الحيوانات المنوية"], correct: 1, explanation: "FSH يحفز الخصيتين لإنتاج الحيوانات المنوية." },
        { text: "ما العلاقة بين المناعة واللقاح؟", options: ["اللقاح يعطي مناعة غير نوعية", "اللقاح يحفز مناعة نوعية مع خلايا ذاكرة", "اللقاح يضعف المناعة", "اللقاح يحتوي على كريات بيض"], correct: 1, explanation: "اللقاح يعرض الجسم لمستضد ضعيف ليحفز مناعة نوعية وخلايا ذاكرة." },
        { text: "ما تأثير هرمون ADH على القنوات الكلوية؟", options: ["يقلل نفاذيتها للماء", "يزيد نفاذيتها للماء", "يمنع إعادة امتصاص الصوديوم", "يزيد إفراز البول"], correct: 1, explanation: "ADH يجعل القنوات الكلوية أكثر نفاذية للماء، فيُعاد امتصاصه." }
      ]
    },
    3: {
      id: 3,
      questions: [
        { text: "ما وظيفة المادة الرمادية في الدماغ؟", options: ["نقل الإشارات السريعة", "احتواء أجسام الخلايا العصبية", "عزل المحاور", "تخزين الهرمونات"], correct: 1, explanation: "المادة الرمادية تحتوي على أجسام الخلايا العصبية وتشابكاتها." },
        { text: "ما الهرمون المسؤول عن تنظيم الكالسيوم؟", options: ["الثيروكسين", "هرمون جارات الدرق", "الأنسولين", "الأوكسيتوسين"], correct: 1, explanation: "هرمون الغدة جارات الدرق يزيد مستوى الكالسيوم في الدم." },
        { text: "ما نوع المناعة التي توفرها الجلد؟", options: ["نوعية", "خلوية", "جسمانية", "غير نوعية"], correct: 3, explanation: "الجلد حاجز ميكانيكي جزء من المناعة غير النوعية." },
        { text: "ما المستقبلات في العين المسؤولة عن الألوان؟", options: ["العصي", "المخاريط", "الخلايا العقدية", "الخلايا الدبقية"], correct: 1, explanation: "المخاريط مسؤولة عن الإبصار الملون والرؤية في الضوء الساطع." },
        { text: "ما تأثير ارتفاع مستوى السكر في الدم؟", options: ["يحفز البنكرياس لإفراز الجلوكاغون", "يحفز البنكرياس لإفراز الأنسولين", "يقلل نشاط الكبد", "يزيد إفراز الأدرينالين"], correct: 1, explanation: "ارتفاع السكر يحفز خلايا بيتا في البنكرياس لإفراز الأنسولين." },
        { text: "ما المرحلة التي يدخل فيها الصوديوم إلى العصبون؟", options: ["إعادة الاستقطاب", "الاستقطاب", "جهد الفعل", "الراحة"], correct: 2, explanation: "جهد الفعل يبدأ بافتتاح قنوات الصوديوم ودخول Na⁺." },
        { text: "ما وظيفة الخلايا التائية المساعدة؟", options: ["تدمير الخلايا المصابة", "تنشيط الخلايا البائية والخلايا القاتلة", "إفراز الأجسام المضادة", "عزل المحاور"], correct: 1, explanation: "الخلايا التائية المساعدة (CD4) تنظم الاستجابة المناعية عبر تنشيط خلايا أخرى." },
        { text: "ما السبب في أن الأجسام المضادة لا تدخل الخلايا؟", options: ["حجمها الكبير", "عدم وجود مستقبلات", "طبيعتها البروتينية", "جميع ما سبق"], correct: 3, explanation: "الأجسام المضادة تعمل خارج الخلايا فقط." },
        { text: "ما الغدة التي تفرز هرمون ACTH؟", options: ["الدرقية", "النخامية", "الكظرية", "البنكرياس"], correct: 1, explanation: "الغدة النخامية الأمامية تفرز ACTH الذي يحفز القشرة الكظرية." },
        { text: "ما تأثير نقص هرمون النمو عند الأطفال؟", options: ["القزامة", "التخلف العقلي", "ضخامة الأطراف", "البلوغ المتأخر"], correct: 0, explanation: "نقص هرمون النمو يؤدي إلى القزامة (النمو القصير)." },
        { text: "ما وظيفة المشبك في التعلم؟", options: ["تثبيت الاتصالات العصبية", "عزل المحاور", "إبطاء الإشارات", "منع التداخل"], correct: 0, explanation: "التغيرات في قوة المشابك (البلاستيكية المشبكية) أساس التعلم والذاكرة." },
        { text: "ما السبب في أن بعض المواد تسبب الإدمان؟", options: ["تدمّر النواقل", "تعزز نواقل المتعة مثل الدوبامين", "تمنع جهد الفعل", "تزيد سرعة التوصيل"], correct: 1, explanation: "المواد المسببة للإدمان تعزز نواقل المتعة مثل الدوبامين في المشابك." },
        { text: "ما وظيفة البلاعم؟", options: ["إفراز الأجسام المضادة", "ابتلاع الممرضات", "تنضج في الزعترية", "نقل الأكسجين"], correct: 1, explanation: "البلاعم (مثل الخلايا الوحيدة) تبتلع وتدمر الممرضات." },
        { text: "ما المستقبلات في الأذن للسمع؟", options: ["كيميائية", "ضوئية", "ميكانيكية", "حرارية"], correct: 2, explanation: "خلايا الشعر في القوقعة تستجيب للاهتزازات الميكانيكية." },
        { text: "ما الهرمون الذي يفرز عند الجفاف؟", options: ["الأوكسيتوسين", "ADH", "الأنسولين", "الجلوكاغون"], correct: 1, explanation: "ADH يفرز عند الجفاف لتقليل فقدان الماء في البول." },
        { text: "ما الفرق بين العصب والعصبون؟", options: ["العصب خلية واحدة", "العصبون مجموعة أعصاب", "العصب حزمة من المحاور", "لا فرق"], correct: 2, explanation: "العصب حزمة من المحاور (محور عصبونات متعددة)." },
        { text: "ما دور هرمون LH عند الإناث؟", options: ["تحفيز نمو البويضة", "إحداث الإباضة", "تنشيط المبيض لإفراز الاستروجين", "جميع ما سبق"], correct: 3, explanation: "LH يحفز الإباضة وإفراز الهرمونات من الجسم الأصفر." },
        { text: "ما العلاقة بين المناعة والحساسية؟", options: ["الحساسية رد مناعي مفرط", "الحساسية ضعف مناعة", "الحساسية لا علاقة لها بالمناعة", "الحساسية مناعة غير نوعية"], correct: 0, explanation: "الحساسية رد فعل مناعي مفرط وغير مناسب ضد مستضدات غير ضارة." },
        { text: "ما تأثير هرمون الثيروكسين على الأيض؟", options: ["يقلله", "يزيده", "لا يؤثر", "يوقفه"], correct: 1, explanation: "الثيروكسين يزيد من معدل الأيض الأساسي في الجسم." },
        { text: "ما السبب في أن العصبون لا ينقسم؟", options: ["لا يحتوي على نواة", "الغشاء غير قابل", "الخلايا الدبقية تمنعه", "الانقسام يتطلب طاقة عالية"], correct: 2, explanation: "العصبونات الناضجة تفقد القدرة على الانقسام بسبب تركيبها المعقد." }
      ]
    },
    4: {
      id: 4,
      questions: [
        { text: "ما وظيفة النخاع الشوكي في الانعكاسات؟", options: ["يحلل المعلومات", "ينفذ ردود الفعل السريعة", "يرسل الإشارات للدماغ فقط", "يفرز الهرمونات"], correct: 1, explanation: "النخاع الشوكي ينفذ الانعكاسات دون انتظار الدماغ لسرعة الاستجابة." },
        { text: "ما الهرمون الذي ينظم الصوديوم في الدم؟", options: ["الأنسولين", "الأوكسيتوسين", "الألدستيرون", "الثيروكسين"], correct: 2, explanation: "الألدستيرون يزيد إعادة امتصاص الصوديوم في الكلى." },
        { text: "ما نوع المناعة التي توفرها البلاعم؟", options: ["نوعية", "غير نوعية", "جسمانية", "خلوية"], correct: 1, explanation: "البلاعم جزء من المناعة غير النوعية (الخط الأول من الدفاع)." },
        { text: "ما المستقبلات في العين للرؤية الليلية؟", options: ["المخاريط", "العصي", "الخلايا العقدية", "الخلايا الدبقية"], correct: 1, explanation: "العصي تعمل في الإضاءة الخافتة ولا تميز الألوان." },
        { text: "ما تأثير انخفاض سكر الدم؟", options: ["يحفز إفراز الأنسولين", "يحفز إفراز الجلوكاغون", "يزيد إفراز ADH", "يقلل نشاط الكظر"], correct: 1, explanation: "انخفاض السكر يحفز خلايا ألفا في البنكرياس لإفراز الجلوكاغون." },
        { text: "ما المرحلة التي يخرج فيها البوتاسيوم من العصبون؟", options: ["جهد الفعل", "الاستقطاب", "إعادة الاستقطاب", "الراحة"], correct: 2, explanation: "في إعادة الاستقطاب، تفتح قنوات البوتاسيوم وK⁺ يخرج." },
        { text: "ما وظيفة الخلايا التائية القاتلة؟", options: ["تنشيط الخلايا البائية", "تدمير الخلايا المصابة بالفيروسات", "إفراز الأجسام المضادة", "ابتلع البكتيريا"], correct: 1, explanation: "الخلايا التائية القاتلة (CD8) تدمر الخلايا المصوبة بالفيروسات أو الخلايا السرطانية." },
        { text: "ما السبب في أن اللقاح لا يسبب المرض؟", options: ["يحتوي على كريات بيض", "يحتوي على مستضد معطل أو جزء منه", "يحتوي على مضادات حيوية", "يحتوي على هرمونات"], correct: 1, explanation: "اللقاح يحتوي على مستضد غير ضار (معطل، ميت، أو جزء منه) لتحفيز المناعة." },
        { text: "ما الغدة التي تفرز هرمون Prolactin؟", options: ["الدرقية", "النخامية", "الكظرية", "البنكرياس"], correct: 1, explanation: "الغدة النخامية الأمامية تفرز البرولاكتين لتحفيز إدرار الحليب." },
        { text: "ما تأثير فرط إفراز هرمون النمو عند البالغين؟", options: ["القزامة", "التخلف العقلي", "ضخامة الأطراف", "البلوغ المبكر"], correct: 2, explanation: "فرط إفراز هرمون النمو بعد إغلاق الصفائح النموية يؤدي إلى تضخم الأطراف (ضخامة الأطراف)." },
        { text: "ما وظيفة المشبك في التكامل العصبي؟", options: ["جمع الإشارات من عصبونات متعددة", "عزل المحاور", "إبطاء الإشارات", "منع التداخل"], correct: 0, explanation: "المشبك يسمح بجمع الإشارات المثيرة والمثبطة من عصبونات متعددة." },
        { text: "ما السبب في أن الكحول يثبط الجهاز العصبي؟", options: ["يحاكي النواقل المثبطة", "يمنع النواقل المثيرة", "يغير جهد الغشاء", "جميع ما سبق"], correct: 3, explanation: "الكحول يعزز تأثير GABA (ناقل مثبط) ويقلل تأثير النواقل المثيرة." },
        { text: "ما وظيفة الخلايا الوحيدة؟", options: ["تتحول إلى بلاعم عند دخول الأنسجة", "تنتج الأجسام المضادة", "تنضج في الزعترية", "تنقل الأكسجين"], correct: 0, explanation: "الخلايا الوحيدة تتحول إلى بلاعم أو خلايا شجرية عند دخول الأنسجة." },
        { text: "ما المستقبلات في الجلد للحرارة؟", options: ["ميكانيكية", "ضوئية", "كيميائية", "حرارية"], correct: 3, explanation: "مستقبلات الحرارة في الجلد تستجيب للتغيرات في درجة الحرارة." },
        { text: "ما الهرمون الذي يفرز عند انخفاض ضغط الدم؟", options: ["الأوكسيتوسين", "ADH", "الأنسولين", "الألدوستيرون"], correct: 1, explanation: "ADH يفرز عند انخفاض ضغط الدم لتقليل فقدان الماء وزيادة الحجم الدموي." },
        { text: "ما الفرق بين المحور والتفرعات الشجرية؟", options: ["التفرعات تستقبل، المحور يرسل", "المحور يستقبل، التفرعات ترسل", "كلاهما يرسل", "كلاهما يستقبل"], correct: 0, explanation: "التفرعات الشجرية تستقبل الإشارات، والمحور يرسلها." },
        { text: "ما دور هرمون FSH عند الإناث؟", options: ["إحداث الإباضة", "تنشيط المبيض لإفراز الاستروجين", "تحفيز نمو البويضة", "جميع ما سبق"], correct: 3, explanation: "FSH يحفز نمو البصيلات وإفراز الإستروجين." },
        { text: "ما العلاقة بين المناعة والأمراض الذاتية؟", options: ["الجسم يهاجم خلاياه بسبب خلل مناعي", "نقص المناعة", "زيادة الخلايا البائية", "ضعف الخلايا التائية"], correct: 0, explanation: "الأمراض الذاتية تنتج عن مهاجمة الجهاز المناعي لخلايا الجسم نفسه." },
        { text: "ما تأثير هرمون الكورتيزول على السكر؟", options: ["يقلله", "يزيده", "لا يؤثر", "يوقفه"], correct: 1, explanation: "الكورتيزول يزيد سكر الدم عبر تحفيز استحداث السكر في الكبد." },
        { text: "ما السبب في أن العصبون يحتاج طاقة عالية؟", options: ["لنقل الأكسجين", "لضخ الأيونات عبر الغشاء", "لتخزين الهرمونات", "لعزل المحور"], correct: 1, explanation: "المضخة الصوديوم-بوتاسيوم تحتاج طاقة (ATP) للحفاظ على جهد الراحة." }
      ]
    },
    5: {
      id: 5,
      questions: [
        { text: "ما الجزء المسؤول عن التوازن في الأذن؟", options: ["القوقعة", "الدهليز والقنوات نصف الدائرية", "طبلة الأذن", "العصب السمعي"], correct: 1, explanation: "الدهليز والقنوات نصف الدائرية في الأذن الداخلية مسؤولة عن التوازن." },
        { text: "ما الهرمون الذي يفرز من الغدة جارات الدرق؟", options: ["الثيروكسين", "هرمون جارات الدرق", "الكالسيتونين", "الأنسولين"], correct: 1, explanation: "الغدة جارات الدرق تفرز هرمونها الذي يزيد الكالسيوم في الدم." },
        { text: "ما نوع المناعة التي توفرها الخلايا التائية؟", options: ["جسمانية", "خلوية", "غير نوعية", "مكتسبة سلبياً"], correct: 1, explanation: "المناعة التي تعتمد على الخلايا التائية تسمى المناعة الخلوية." },
        { text: "ما العصب المسؤول عن حاسة الشم؟", options: ["البصري", "الشمّي", "الوجهي", "السمعي"], correct: 1, explanation: "العصب الشمي (العصب الدماغي الأول) مسؤول عن حاسة الشم." },
        { text: "ما تأثير ارتفاع الكالسيوم في الدم على العظام؟", options: ["يزيد الترسيب", "يزيد الامتصاص", "لا يؤثر", "يقوي العظام"], correct: 1, explanation: "ارتفاع الكالسيوم يحفز امتصاص العظام عبر تثبيط الكالسيتونين وتنشيط جارات الدرق." },
        { text: "ما المرحلة التي يكون فيها العصبون غير قابل للتثير؟", options: ["الاستقطاب", "إعادة الاستقطاب", "فترة الاسترداد", "الراحة"], correct: 2, explanation: "في فترة الاسترداد (المطلقة والنسبة)، العصبون غير قابل للتثير." },
        { text: "ما وظيفة الخلايا البائية الذاكرة؟", options: ["تدمير الخلايا المصوبة", "الاستجابة السريعة عند التعرض الثاني", "إفراز الهرمونات", "ابتلع البكتيريا"], correct: 1, explanation: "خلايا الذاكرة تستجيب بسرعة وفعالية عند التعرض الثاني للمستضد." },
        { text: "ما السبب في أن بعض الفيروسات تتجنب المناعة؟", options: ["تغيير مستضداتها", "اختراق الخلايا", "تدمير الخلايا التائية", "جميع ما سبق"], correct: 3, explanation: "الفيروسات تتجنب المناعة بتغيير مستضداتها أو الاختباء داخل الخلايا." },
        { text: "ما الغدة التي تفرز هرمون MSH؟", options: ["الدرقية", "النخامية", "الكظرية", "البنكرياس"], correct: 1, explanation: "MSH (هرمون مُظلم الجلد) يفرز من النخامية ويؤثر على التصبغ." },
        { text: "ما تأثير نقص هرمون ADH؟", options: ["زيادة إنتاج البول", "نقص إنتاج البول", "زيادة العطش فقط", "لا تأثير"], correct: 0, explanation: "نقص ADH يؤدي إلى مرض السكري الكاذب (كثرة التبول والعطش)." },
        { text: "ما وظيفة المشبك في التصفية العصبية؟", options: ["منع الإشارات الضعيفة", "عزل المحاور", "إبطاء الإشارات", "تعزيز جميع الإشارات"], correct: 0, explanation: "المشبك يمنع الإشارات الضعيفة من التسبب في جهد فعل (التكامل العصبي)." },
        { text: "ما السبب في أن الكافيين منبه؟", options: ["يحاكي الدوبامين", "يمنع تأثير الأدينوزين (المثبط)", "يزيد إفراز الأدرينالين", "جميع ما سبق"], correct: 1, explanation: "الكافيين يمنع مستقبلات الأدينوزين المثبطة، مما يزيد النشاط العصبي." },
        { text: "ما وظيفة الخلايا الشجرية؟", options: ["عرض المستضدات للخلايا التائية", "إفراز الأجسام المضادة", "تدمير الخلايا المصوبة", "نقل الأكسجين"], correct: 0, explanation: "الخلايا الشجرية تعرض المستضدات للخلايا التائية لتنشيطها." },
        { text: "ما المستقبلات في اللسان للحموضة؟", options: ["كيميائية", "ضوئية", "ميكانيكية", "حرارية"], correct: 0, explanation: "مستقبلات التذوق كيميائية وتستجيب لجزيئات الحمض." },
        { text: "ما الهرمون الذي يفرز عند ارتفاع ضغط الدم؟", options: ["ADH", "الأوكسيتوسين", "ANP", "الألدوستيرون"], correct: 2, explanation: "ANP يفرز من القلب عند ارتفاع الضغط لزيادة إفراز الصوديوم والماء." },
        { text: "ما الفرق بين العصبون متعدد الأقطاب ووحيد القطبية؟", options: ["عدد المحاور", "عدد التفرعات", "الموقع في الجسم", "جميع ما سبق"], correct: 3, explanation: "العصبونات متعددة الأقطاب (الأكثر شيوعاً) تحتوي على محور وتفرعات شجرية." },
        { text: "ما دور هرمون الاستروجين؟", options: ["تنمية الخصائص الجنسية الثانوية عند الإناث", "تحفيز تكوين الحيوانات المنوية", "زيادة الكالسيوم", "خفض سكر الدم"], correct: 0, explanation: "الاستروجين مسؤول عن الخصائص الجنسية الثانوية عند الإناث." },
        { text: "ما العلاقة بين المناعة واللقاحات الحية؟", options: ["اللقاحات الحية تعطي مناعة أضعف", "اللقاحات الحية تعطي مناعة أقوى وأطول", "اللقاحات الحية لا تستخدم", "اللقاحات الحية تسبب المرض"], correct: 1, explanation: "اللقاحات الحية المضعفة تعطي مناعة قوية وطويلة الأمد." },
        { text: "ما تأثير هرمون الألدوستيرون على البوتاسيوم؟", options: ["يزيده في الدم", "يقلله في الدم", "لا يؤثر", "يوقفه"], correct: 1, explanation: "الأ aldosterone يزيد إفراز البوتاسيوم في البول، فيقل مستواه في الدم." },
        { text: "ما السبب في أن العصبون لا يحتوي على جسيمات ميتوكندريا كثيرة؟", options: ["كاذب، بل يحتوي على الكثير", "لا يحتاج طاقة", "يعتمد على الغليكوغلوبين", "يحتوي على جسيمات ليزوزومية بدلاً منها"], correct: 0, explanation: "العصبونات تحتوي على العديد من الميتوكندريا لتوفير الطاقة لنقل الإشارات." }
      ]
    },
    6: {
      id: 6,
      questions: [
        { text: "ما الجزء المسؤول عن السمع في الأذن؟", options: ["الدهليز", "القوقعة", "القنوات نصف الدائرية", "طبلة الأذن"], correct: 1, explanation: "القوقعة في الأذن الداخلية تحتوي على خلايا شعرية للسمع." },
        { text: "ما الهرمون الذي يفرز من الغدة الدرقية لخفض الكالسيوم؟", options: ["الثيروكسين", "هرمون جارات الدرق", "الكالسيتونين", "الأنسولين"], correct: 2, explanation: "الكالسيتونين يخفض مستوى الكالسيوم في الدم عبر تثبيط امتصاص العظام." },
        { text: "ما نوع المناعة التي توفرها الأجسام المضادة؟", options: ["خلوية", "نوعية", "غير نوعية", "جسمانية"], correct: 3, explanation: "الأجسام المضادة جزء من المناعة الجسمانية (التي تعمل في السوائل الجسمية)." },
        { text: "ما العصب المسؤول عن حاسة البصر؟", options: ["الشمّي", "البصري", "الوجهي", "السمعي"], correct: 1, explanation: "العصب البصري (العصب الدماغي الثاني) ينقل إشارات الرؤية." },
        { text: "ما تأثير انخفاض الكالسيوم في الدم؟", options: ["يحفز الغدة جارات الدرق", "يثبط الغدة جارات الدرق", "لا يؤثر", "يزيد إفراز الثيروكسين"], correct: 0, explanation: "انخفاض الكالسيوم يحفز الغدة جارات الدرق لإفراز هرمونها." },
        { text: "ما المرحلة التي تكون فيها قنوات الصوديوم مغلقة بعد جهد الفعل؟", options: ["الاستقطاب", "إعادة الاستقطاب", "فترة الاسترداد المطلقة", "الراحة"], correct: 2, explanation: "في فترة الاسترداد المطلقة، قنوات الصوديوم مغلقة ولا يمكن توليد جهد فعل." },
        { text: "ما وظيفة الخلايا التائية الذاكرة؟", options: ["تدمير الخلايا المصوبة", "الاستجابة السريعة عند التعرض الثاني", "إفراز الأجسام المضادة", "ابتلع البكتيريا"], correct: 1, explanation: "خلايا الذاكرة التائية تستجيب بسرعة عند التعرض الثاني للمستضد." },
        { text: "ما السبب في أن البكتيريا خارج الخلايا؟", options: ["لأنها كبيرة", "لأنها لا تستطيع الدخول", "لأنها تتكاثر خارج الخلايا", "جميع ما سبق"], correct: 2, explanation: "العديد من البكتيريا تتكاثر في السوائل خارج الخلايا، لذا تستهدفها المناعة الجسمانية." },
        { text: "ما الغدة التي تفرز هرمون Oxytocin؟", options: ["النخامية الأمامية", "النخامية الخلفية", "الوطاء", "الكظرية"], correct: 1, explanation: "الأوكسيتوسين يُخزن ويُفرز من الفص الخلفي للنخامية." },
        { text: "ما تأثير فرط إفراز الكورتيزول؟", options: ["مرض كوشينغ", "مرض أديسون", "السكري", "التخلف العقلي"], correct: 0, explanation: "فرط الكورتيزول يؤدي إلى متلازمة كوشينغ (السمنة، ارتفاع السكر، إلخ)." },
        { text: "ما وظيفة المشبك في التعلم والذاكرة؟", options: ["تثبيت الروابط العصبية", "عزل المحاور", "إبطاء الإشارات", "منع التداخل"], correct: 0, explanation: "التغيرات في قوة المشابك (البلاستيكية) أساس تكوين الذاكرة." },
        { text: "ما السبب في أن النيكوتين منبه؟", options: ["يحاكي الأستيل كولين", "يمنع الدوبامين", "يزيد إفراز الأدرينالين", "جميع ما سبق"], correct: 0, explanation: "النيكوتين يحاكي الأستيل كولين في المشابك العصبية والعضلية." },
        { text: "ما وظيفة الخلايا القاتلة الطبيعية؟", options: ["إفراز الأجسام المضادة", "تدمير الخلايا السرطانية والمصوبة", "عرض المستضدات", "نقل الأكسجين"], correct: 1, explanation: "الخلايا القاتلة الطبيعية (NK) جزء من المناعة غير النوعية وتستهدف الخلايا غير الطبيعية." },
        { text: "ما المستقبلات في الجلد للألم؟", options: ["ميكانيكية", "ضوئية", "كيميائية", "حرة (غير مغلفة)"], correct: 3, explanation: "مستقبلات الألم (نهايات عصبية حرة) غير مغلفة وتستجيب للمؤثرات المؤلمة." },
        { text: "ما الهرمون الذي يفرز عند الجوع؟", options: ["الأنسولين", "الجلوكاغون", "الأوكسيتوسين", "ADH"], correct: 1, explanation: "الجلوكاغون يفرز عند الجوع لرفع سكر الدم." },
        { text: "ما الفرق بين المحور والتفرعات الشجرية في التركيب؟", options: ["المحور طويل، التفرعات قصيرة", "المحور يحتوي على غمد مايلين، التفرعات لا", "المحور يرسل، التفرعات تستقبل", "جميع ما سبق"], correct: 3, explanation: "المحور طويل وغالباً مغلف، بينما التفرعات قصيرة وغير مغلفة." },
        { text: "ما دور هرمون التستوستيرون؟", options: ["تنمية الخصائص الجنسية الثانوية عند الذكور", "تحفيز تكوين البويضات", "زيادة الكالسيوم", "خفض سكر الدم"], correct: 0, explanation: "التستوستيرون مسؤول عن الخصائص الجنسية الثانوية عند الذكور." },
        { text: "ما العلاقة بين المناعة والسرطان؟", options: ["المناعة تكتشف وتدمر الخلايا السرطانية", "السرطان يقوي المناعة", "السرطان لا علاقة له بالمناعة", "المناعة تسبب السرطان"], correct: 0, explanation: "المناعة (خاصة NK والخلايا التائية القاتلة) تراقب وتدمر الخلايا السرطانية." },
        { text: "ما تأثير هرمون ANP على الصوديوم؟", options: ["يزيده في الدم", "يقلله في الدم", "لا يؤثر", "يوقفه"], correct: 1, explanation: "ANP يزيد إفراز الصوديوم في البول، فيقل مستواه في الدم." },
        { text: "ما السبب في أن العصبون يحتاج إلى غمد المايلين؟", options: ["لزيادة سرعة التوصيل", "لحمايته", "لتغذيته", "جميع ما سبق"], correct: 3, explanation: "المايلين يزيد السرعة، ويعزل، ويحمي المحور العصبي." }
      ]
    },
    7: {
      id: 7,
      questions: [
        { text: "ما العصب المسؤول عن حاسة التذوق في اللسان؟", options: ["البصري", "الشمّي", "الوجهي واللسان والبلعومي", "السمعي"], correct: 2, explanation: "أعصاب الوجه (VII)، اللسان والبلعومي (IX) مسؤولة عن التذوق." },
        { text: "ما الهرمون الذي يفرز من البنكرياس لرفع سكر الدم؟", options: ["الأنسولين", "الجلوكاغون", "الأوكسيتوسين", "ADH"], correct: 1, explanation: "الجلوكاغون يرفع سكر الدم عبر تحفيز تحلل الجليكوجين في الكبد." },
        { text: "ما نوع المناعة التي توفرها الجلد والأغشية المخاطية؟", options: ["نوعية", "جسمانية", "غير نوعية", "خلوية"], correct: 2, explanation: "الجلد والأغشية المخاطية جزء من المناعة غير النوعية (الخط الأول)." },
        { text: "ما العصب المسؤول عن حاسة السمع؟", options: ["البصري", "الشمّي", "الوجهي", "الدهليزي القوقعي"], correct: 3, explanation: "العصب الدهليزي القوقعي (العصب الدماغي الثامن) مسؤول عن السمع والتوازن." },
        { text: "ما تأثير ارتفاع الصوديوم في الدم؟", options: ["يحفز إفراز الألدستيرون", "يثبط إفراز الألدستيرون", "لا يؤثر", "يزيد إفراز ADH"], correct: 1, explanation: "ارتفاع الصوديوم يثبط الألدستيرون لتقليل إعادة امتصاصه." },
        { text: "ما المرحلة التي يعود فيها الغشاء إلى جهد الراحة؟", options: ["جهد الفعل", "إعادة الاستقطاب", "فرط الاستقطاب", "الراحة"], correct: 1, explanation: "إعادة الاستقطاب هي العودة إلى جهد الراحة بعد جهد الفعل." },
        { text: "ما وظيفة الخلايا البائية عند تنشيطها؟", options: ["تتحول إلى خلايا بلازمية", "تدمر الخلايا المصوبة", "تفرز الهرمونات", "تنقسم فقط"], correct: 0, explanation: "الخلايا البائية المنشطة تتحول إلى خلايا بلازمية تفرز الأجسام المضادة." },
        { text: "ما السبب في أن اللقاحات غير النشطة تحتاج جرعات معززة؟", options: ["لأنها لا تعطي مناعة", "لأنها تعطي مناعة أضعف", "لأنها تسبب المرض", "لأنها لا تحتوي على مستضد"], correct: 1, explanation: "اللقاحات غير النشطة (المعطلة) تعطي مناعة أضعف، لذا تحتاج معززات." },
        { text: "ما الغدة التي تفرز هرمون ADH؟", options: ["النخامية الأمامية", "النخامية الخلفية", "الوطاء", "الكظرية"], correct: 1, explanation: "ADH يُخزن ويُفرز من الفص الخلفي للنخامية." },
        { text: "ما تأثير نقص الكورتيزول؟", options: ["مرض كوشينغ", "مرض أديسون", "السكري", "التخلف العقلي"], correct: 1, explanation: "نقص الكورتيزول يؤدي إلى مرض أديسون (الضعف، انخفاض السكر، إلخ)." },
        { text: "ما وظيفة المشبك في التثبيط؟", options: ["منع جهد الفعل", "عزل المحاور", "إبطاء الإشارات", "تعزيز الإشارات"], correct: 0, explanation: "المشبك المثبط يمنع توليد جهد الفعل في العصبون التالي." },
        { text: "ما السبب في أن الهيروين مثبط؟", options: ["يحاكي الإندورفين", "يمنع الدوبامين", "يزيد إفراز الأدرينالين", "جميع ما سبق"], correct: 0, explanation: "الهيروين يحاكي الإندورفين (المسكنات الطبيعية) في المشابك." },
        { text: "ما وظيفة الخلايا البلازمية؟", options: ["إفراز الأجسام المضادة", "تدمير الخلايا المصوبة", "عرض المستضدات", "نقل الأكسجين"], correct: 0, explanation: "الخلايا البلازمية (من الخلايا البائية) تفرز كميات كبيرة من الأجسام المضادة." },
        { text: "ما المستقبلات في العين للضوء؟", options: ["كيميائية", "ضوئية", "ميكانيكية", "حرارية"], correct: 1, explanation: "العديسات والشبكية تحتوي على مستقبلات ضوئية (العصي والمخاريط)." },
        { text: "ما الهرمون الذي يفرز عند الإجهاد؟", options: ["الأنسولين", "الأوكسيتوسين", "الأدرينالين والكورتيزول", "ADH"], correct: 2, explanation: "الإجهاد يحفز إفراز الأدرينالين (اللحظي) والكورتيزول (الطويل الأمد)." },
        { text: "ما الفرق بين العصبون الحسي والحركي في تركيبه؟", options: ["الحسي جسمه خارج النخاع", "الحسي يحتوي على غمد مايلين فقط", "الحسي لا يحتوي على تفرعات", "الحسي أقصر"], correct: 0, explanation: "جسم الخلية في العصبون الحسي موجود في العقدة خارج النخاع." },
        { text: "ما دور هرمون البرولاكتين؟", options: ["تحفيز إدرار الحليب", "تنشيط المبيض", "زيادة الكالسيوم", "خفض سكر الدم"], correct: 0, explanation: "البرولاكتين يحفز الغدد اللبنية لإدرار الحليب بعد الولادة." },
        { text: "ما العلاقة بين المناعة والحساسية؟", options: ["الحساسية رد مناعي مفرط على مستضد غير ضار", "الحساسية ضعف مناعة", "الحساسية لا علاقة لها بالمناعة", "الحساسية مناعة نوعية فقط"], correct: 0, explanation: "الحساسية رد فعل مناعي مفرط وغير مناسب ضد مستضدات غير ضارة (مثل حبوب اللقاح)." },
        { text: "ما تأثير هرمون الجلوكاغون على الكبد؟", options: ["يحفز تخزين الجليكوجين", "يحفز تحلل الجليكوجين", "لا يؤثر", "يوقف الأيض"], correct: 1, explanation: "الجلوكاغون يحفز الكبد على تحلل الجليكوجين إلى جلوكوز." },
        { text: "ما السبب في أن العصبون لا يتجدد في الجهاز العصبي المركزي؟", options: ["وجود عوامل مثبطة في البيئة", "عدم قدرته على الانقسام", "الخلايا الدبقية تمنعه", "جميع ما سبق"], correct: 3, explanation: "العوامل المثبطة في بيئة الجهاز العصبي المركزي وتركيب العصبون تمنع تجدده." }
      ]
    }
  }

  const currentExamData = exams[currentExam]

  // Show promotional box after question 10
  useEffect(() => {
    if (!showResults && !promotionalBoxShown && currentQuestion >= 10) {
      setShowPromotionalBox(true)
      setPromotionalBoxShown(true)
    }
  }, [currentQuestion, showResults, promotionalBoxShown])

  // Show contact message after last question
  useEffect(() => {
    if (!showResults && currentQuestion === (currentExamData?.questions.length || 0) - 1) {
      setShowContactMessage(true)
    }
  }, [currentQuestion, showResults, currentExamData])

  useEffect(() => {
    if (timeLeft > 0 && !showResults) {
      const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000)
      return () => clearTimeout(timer)
    } else if (timeLeft === 0 && !showResults) {
      handleSubmit()
    }
  }, [timeLeft, showResults])

  const formatTime = (seconds: number) => {
    const minutes = Math.floor(seconds / 60)
    const secs = seconds % 60
    return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`
  }

  const handleAnswer = (questionIndex: number, answer: string) => {
    setAnswers(prev => ({
      ...prev,
      [`q${questionIndex}`]: answer
    }))
  }

  const handleSubmit = () => {
    setShowResults(true)
    setSubmitted(true)
  }

  const resetExam = () => {
    setAnswers({})
    setShowResults(false)
    setCurrentQuestion(0)
    setTimeLeft(30 * 60)
    setSubmitted(false)
    setShowPromotionalBox(false)
    setPromotionalBoxShown(false)
    setShowContactMessage(false)
  }

  const handleFormSubmission = () => {
    setFormSubmitted(true)
    setShowPromotionalBox(false)
  }

  const closePromotionalBox = () => {
    setShowPromotionalBox(false)
  }

  const calculateScore = () => {
    if (!currentExamData) return { correct: 0, total: 0, percentage: 0 }
    
    let correct = 0
    currentExamData.questions.forEach((question, index) => {
      const userAnswer = answers[`q${index}`]
      if (userAnswer && parseInt(userAnswer) === question.correct) {
        correct++
      }
    })
    
    return {
      correct,
      total: currentExamData.questions.length,
      percentage: Math.round((correct / currentExamData.questions.length) * 100)
    }
  }

  const handleNext = () => {
    if (currentQuestion < (currentExamData?.questions.length || 0) - 1) {
      setCurrentQuestion(currentQuestion + 1)
    }
  }

  const handlePrevious = () => {
    if (currentQuestion > 0) {
      setCurrentQuestion(currentQuestion - 1)
    }
  }

  if (showResults) {
    const score = calculateScore()
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 p-4">
        <div className="max-w-4xl mx-auto">
          <div className="bg-white rounded-2xl shadow-xl p-8">
            <h2 className="text-3xl font-bold text-center mb-6">نتائج الامتحان</h2>
            
            <div className="text-center mb-8">
              <div className="text-5xl font-bold text-green-600 mb-2">
                {score.correct} / {score.total}
              </div>
              <div className="text-xl text-gray-600">
                النسبة المئوية: {score.percentage}%
              </div>
            </div>

            <div className="space-y-4 max-h-96 overflow-y-auto">
              {currentExamData?.questions.map((question, index) => {
                const userAnswer = answers[`q${index}`]
                const isCorrect = userAnswer && parseInt(userAnswer) === question.correct
                
                return (
                  <div key={index} className="border rounded-lg p-4">
                    <div className="flex justify-between items-start mb-2">
                      <h3 className="font-semibold">السؤال {index + 1}:</h3>
                      <span className={`px-2 py-1 rounded ${isCorrect ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                        {isCorrect ? 'صحيح' : 'خطأ'}
                      </span>
                    </div>
                    <p className="mb-2">{question.text}</p>
                    <div className="text-sm text-gray-600 mb-2">
                      <span>إجابتك: {userAnswer ? question.options[parseInt(userAnswer)] : 'لم تُجب'}</span>
                      {!isCorrect && <span className="block text-green-700">الإجابة الصحيحة: {question.options[question.correct]}</span>}
                    </div>
                    <div className="bg-blue-50 p-3 rounded text-sm">
                      <strong>الشرح:</strong> {question.explanation}
                    </div>
                  </div>
                )
              })}
            </div>

            <div className="flex gap-4 mt-8">
              <button
                onClick={resetExam}
                className="flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors"
              >
                <RotateCcw className="inline w-4 h-4 ml-2" />
                إعادة الامتحان
              </button>
              <button
                onClick={() => navigate('/')}
                className="flex-1 bg-gray-600 text-white py-3 px-6 rounded-lg hover:bg-gray-700 transition-colors"
              >
                العودة للرئيسية
              </button>
            </div>
          </div>
        </div>
      </div>
    )
  }

  if (!currentExamData) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center">
        <div className="text-white text-xl">جاري التحميل...</div>
      </div>
    )
  }

  const currentQuestionData = currentExamData.questions[currentQuestion]

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 p-4">
      <div className="max-w-4xl mx-auto">
        {/* Header */}
        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
          <div className="flex justify-between items-center">
            <h1 className="text-2xl font-bold text-gray-900">
              بنك امتحانات أحياء – الصف الثاني عشر (الفصل الأول)
            </h1>
            <div className="flex items-center gap-4">
              <div className="bg-red-100 text-red-700 px-4 py-2 rounded-lg font-mono">
                <Clock className="inline w-4 h-4 ml-2" />
                {formatTime(timeLeft)}
              </div>
              <span className="text-gray-600">
                السؤال {currentQuestion + 1} من {currentExamData.questions.length}
              </span>
            </div>
          </div>
        </div>

        {/* Question */}
        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
          <div className="mb-6">
            <div className="text-lg font-semibold text-blue-600 mb-2">
              السؤال {currentQuestion + 1}
            </div>
            <p className="text-lg text-gray-800 leading-relaxed">
              {currentQuestionData.text}
            </p>
          </div>

          {/* Options */}
          <div className="space-y-3">
            {currentQuestionData.options.map((option, index) => (
              <label
                key={index}
                className={`flex items-center p-4 border rounded-lg cursor-pointer transition-colors ${
                  answers[`q${currentQuestion}`] === index.toString()
                    ? 'border-blue-500 bg-blue-50'
                    : 'border-gray-200 hover:border-gray-300'
                }`}
              >
                <input
                  type="radio"
                  name={`question-${currentQuestion}`}
                  value={index}
                  checked={answers[`q${currentQuestion}`] === index.toString()}
                  onChange={() => handleAnswer(currentQuestion, index.toString())}
                  className="ml-3"
                />
                <span className="text-gray-800">{option}</span>
              </label>
            ))}
          </div>
        </div>

        {/* Navigation */}
        <div className="bg-white rounded-2xl shadow-xl p-6">
          <div className="flex justify-between items-center">
            <button
              onClick={handlePrevious}
              disabled={currentQuestion === 0}
              className="flex items-center px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <ChevronRight className="w-4 h-4 ml-1" />
              السابق
            </button>

            <button
              onClick={handleSubmit}
              className="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 transition-colors"
            >
              تصحيح الامتحان
            </button>

            <button
              onClick={handleNext}
              disabled={currentQuestion === currentExamData.questions.length - 1}
              className="flex items-center px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              التالي
              <ChevronLeft className="w-4 h-4 mr-1" />
            </button>
          </div>
        </div>

        {/* Exam Selector */}
        <div className="bg-white rounded-2xl shadow-xl p-6 mt-6">
          <div className="text-center mb-4">
            <label className="block text-lg font-semibold mb-2">اختر الامتحان:</label>
            <select
              value={currentExam}
              onChange={(e) => {
                setCurrentExam(parseInt(e.target.value))
                resetExam()
              }}
              className="w-full max-w-xs mx-auto p-2 border border-gray-300 rounded-lg text-center"
            >
              <option value={1}>الامتحان التدريبي 1</option>
              <option value={2}>الامتحان التدريبي 2</option>
              <option value={3}>الامتحان التدريبي 3</option>
              <option value={4}>الامتحان التدريبي 4</option>
              <option value={5}>الامتحان التدريبي 5</option>
              <option value={6}>الامتحان التدريبي 6</option>
              <option value={7}>الامتحان التدريبي 7</option>
            </select>
          </div>
          
          <div className="text-center">
            <button
              onClick={() => navigate('/')}
              className="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition-colors"
            >
              العودة للرئيسية
            </button>
          </div>
        </div>

        {/* Contact Message */}
        {showContactMessage && <ContactMessage />}

        {/* Final Exam Message */}
        {currentQuestion === (currentExamData?.questions.length || 0) - 1 && !formSubmitted && (
          <div className="bg-white rounded-2xl shadow-xl p-6 mt-6 text-center">
            <h3 className="text-xl font-bold text-green-700 mb-2">
              تهانينا! لقد أكملت جميع أسئلة هذا الامتحان
            </h3>
            <p className="text-gray-600 mb-4">
              احصل على كل الأسئلة والامتحانات مع الإجابات والشرح من خلال التواصل معنا
            </p>
            <p className="text-sm text-blue-600 font-medium">
              جملة: 97152928
            </p>
          </div>
        )}
      </div>

      {/* Promotional Box */}
      {showPromotionalBox && (
        <PromotionalBox
          onClose={closePromotionalBox}
          onFormSubmit={handleFormSubmission}
        />
      )}
    </div>
  )
}

export default Biology12